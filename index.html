<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOULTEST - SCL-90心理健康测试</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
function checkAuthPass() {
  const code = localStorage.getItem('scl90_authorized');
  const expire = parseInt(localStorage.getItem('scl90_expire'), 10);
  if (code && expire && Date.now() < expire) {
    startTest(); // ✅ 仍在48小时内，直接进测试
    return true;
  } else {
    localStorage.removeItem('scl90_authorized');
    localStorage.removeItem('scl90_expire');
    return false;
  }
}
$(document).ready(function () {
  if (!checkAuthPass()) showPage('home'); // ✅ 没通行证，正常首页
});
</script>

    
    <!-- Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#10B981',
                        background: '#F9FAFB',
                        text: '#111827',
                        light: '#F0F4F8',
                        card: '#FFFFFF',
                        'card-hover': '#F9FAFB',
                        'primary-light': '#E0E7FF',
                        'secondary-light': '#D1FAE5',
                        'warning-light': '#FEF3C7',
                        'danger-light': '#FEE2E2',
                        muted: '#6B7280'
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                    borderRadius: {
                        '12': '12px',
                        '16': '16px',
                        '20': '20px',
                    },
                    screens: {
                        'xs': '360px',    // 小型手机
                        'sm': '640px',    // 手机
                        'md': '768px',    // 平板
                        'lg': '1024px',   // 桌面
                        'xl': '1280px',   // 大屏桌面
                    }
                },
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            }
            .transition-smooth {
                transition: all 0.2s ease;
            }
            .nav-item-active {
                @apply text-primary border-b-2 border-primary;
            }
            .option-item {
                @apply border border-gray-200 hover:border-primary rounded-12 p-3 xs:p-3.5 sm:p-4 cursor-pointer transition-smooth;
            }
            .option-item.selected {
                @apply border-primary bg-primary/5;
            }
            .table-cell-nowrap {
                white-space: nowrap;
            }
            .status-normal {
                @apply bg-green-100 text-green-800;
            }
            .status-mild {
                @apply bg-yellow-100 text-yellow-800;
            }
            .status-significant {
                @apply bg-red-100 text-red-800;
            }
        }
    </style>
</head>
<body class="bg-background font-inter text-text">
    <!-- 顶部导航栏 -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <!-- Logo -->
            <div class="flex items-center">
                <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center mr-2">
                    <span class="text-white font-bold">S</span>
                </div>
                <h1 class="text-xl font-bold">SOULTEST</h1>
            </div>
            
            <!-- 桌面端导航 -->
            <nav class="hidden lg:flex items-center space-x-6">
                <a href="#" id="nav-home" class="nav-item-active py-2 border-b-2 border-primary">首页</a>
                <a href="#" id="nav-about" class="py-2 text-muted hover:text-primary border-b-2 border-transparent hover:border-primary/30">关于</a>
                <a href="#" id="nav-history" class="py-2 text-muted hover:text-primary border-b-2 border-transparent hover:border-primary/30">我的</a>
            </nav>
            
            <!-- 移动端端菜单按钮 -->
            <button id="mobile-menu-button" class="lg:hidden text-muted hover:text-primary">
                <i class="fa fa-bars text-xl"></i>
            </button>
        </div>
        
        <!-- 移动端导航菜单 -->
        <div id="mobile-menu" class="lg:hidden bg-white border-t border-gray-100 hidden">
            <div class="container mx-auto px-4 py-2">
                <a href="#" id="mobile-nav-home" class="block py-3 px-4 rounded-lg bg-primary/5 text-primary font-medium">首页</a>
                <a href="#" id="mobile-nav-about" class="block py-3 px-4 rounded-lg hover:bg-light">关于</a>
                <a href="#" id="mobile-nav-history" class="block py-3 px-4 rounded-lg hover:bg-light">我的</a>
            </div>
        </div>
    </header>

    <!-- 主内容区 - 优化移动端一屏可见 -->
    <main class="container mx-auto px-3 py-3 min-h-screen-[calc(100vh-120px)]">
        <!-- 首页 -->
        <div id="home-page">
            <!-- 标题区域 - 优化设计 -->
            <div class="text-center mb-6 pt-6">
                <h1 class="text-xl sm:text-2xl md:text-3xl font-bold mb-2">SCL-90 心理健康测试</h1>
                <p class="text-muted text-sm sm:text-base max-w-sm mx-auto">症状自评量表(SCL-90)是世界上最著名的心理健康测试量表之一，用于90个项目，从多个维度维度评估心理健康状况。</p>
            </div>
            
            <!-- 功能栏目 - 优化布局 -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6 mb-8">
                <div class="bg-white rounded-xl p-4 card-shadow flex items-start">
                    <div class="bg-primary/10 rounded-full p-2.5 mr-3 flex-shrink-0">
                        <i class="fa fa-check-circle text-primary text-base sm:text-lg"></i>
                    </div>
                    <div>
                        <h3 class="text-base sm:text-lg font-semibold mb-1">科学量表</h3>
                        <p class="text-muted text-sm sm:text-base">采用国际通用的SCL-90量表，包含90个问题，涵盖9个维度的心理健康评估。</p>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-4 card-shadow flex items-start">
                    <div class="bg-primary/10 rounded-full p-2.5 mr-3 flex-shrink-0">
                        <i class="fa fa-line-chart text-primary text-base sm:text-lg"></i>
                    </div>
                    <div>
                        <h3 class="text-base sm:text-lg font-semibold mb-1">详细分析</h3>
                        <p class="text-muted text-sm sm:text-base">测试完成后，将自动为您生成详细的分析报告，包括总分维度得分和专业建议。</p>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-4 card-shadow flex items-start">
                    <div class="bg-primary/10 rounded-full p-2.5 mr-3 flex-shrink-0">
                        <i class="fa fa-lock text-primary text-base sm:text-lg"></i>
                    </div>
                    <div>
                        <h3 class="text-base sm:text-lg font-semibold mb-1">隐私保障</h3>
                        <p class="text-muted text-sm sm:text-base">所有测试数据仅存储在您的设备本地，不会上传至服务器，保障您的隐私安全。</p>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-4 card-shadow flex items-start">
                    <div class="bg-primary/10 rounded-full p-2.5 mr-3 flex-shrink-0">
                        <i class="fa fa-mobile text-primary text-base sm:text-lg"></i>
                    </div>
                    <div>
                        <h3 class="text-base sm:text-lg font-semibold mb-1">三端适配</h3>
                        <p class="text-muted text-sm sm:text-base">完美支持手机、平板和桌面电脑，随时随地进行心理健康测试。</p>
                    </div>
                </div>
            </div>
            
            <!-- 开始测试按钮 - 确保在移动端一屏可见 -->
            <div class="text-center">
                <button id="start-test-btn" class="bg-primary hover:bg-primary/90 text-white py-3 sm:py-4 px-8 sm:px-10 rounded-2xl font-medium transition-smooth text-base sm:text-lg shadow-lg shadow-primary/20 hover:shadow-primary/30 inline-flex items-center">
                    开始测试
                    <i class="fa fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>

        <!-- 关于页面 -->
        <div id="about-page" class="hidden">
            <div class="max-w-3xl mx-auto">
                <!-- 标题 -->
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-bold mb-2">关于本测试</h2>
                    <p class="text-muted">了解SCL-90心理健康测试的相关信息</p>
                </div>
                
                <!-- 网站介绍 -->
                <div class="bg-white rounded-xl p-6 mb-6">
                    <h3 class="text-xl font-semibold mb-4">网站介绍</h3>
                    <p class="text-muted mb-4">SOULTEST是一个专注于心理健康测试的在线平台，致力于为用户提供专业、便捷的心理健康评估服务。我们采用国际通用的心理评估量表，帮助用户提供科学、客观的心理健康评估。</p>
                    <p class="text-muted">我们的使命是通过科技手段，让心理健康评估更加普及、便捷、科学，帮助更多人关注和关注自己自己的心理健康状况。</p>
                </div>
                
                <!-- 测试简介 -->
                <div class="bg-white rounded-xl p-6 mb-6">
                    <h3 class="text-xl font font-semibold mb-4">测试简介</h3>
                    <p class="text-muted mb-4">症状自评量表(Symptom Checklist 90, SCL-90)是由Derogatis, L. R.于1975年编制的，是目前世界上最著名的心理健康评估量表之一。</p>
                    <p class="text-muted mb-4">该量表包含90个项目，涵盖了广泛的心理症状，包括躯体化、强迫症状、人际关系敏感、抑郁、焦虑、敌对、恐怖、偏执、精神病性等9个维度。</p>
                    <p class="text-muted">通过对这些维度的评估，可以全面了解测试者的心理健康状况，为心理健康提供参考。</p>
                </div>
                
                <!-- 评分标准 -->
                <div class="bg-white rounded-xl p-6 mb-6">
                    <h3 class="text-xl font font-semibold mb-4">评分标准</h3>
                    <p class="text-muted mb-4">SCL-90采用5级评分制，每个项目的评分标准如下：</p>
                    <ul class="list-disc list-inside text-muted space-y-2">
                        <li><span class="font-medium">从无：</span>自觉无该项症状</li>
                        <li><span class="font-medium">很轻：</span>自觉有该项症状，但对受检者并无实际影响，或影响轻微</li>
                        <li><span class="font-medium">中等：</span>自觉有该项症状，对受检者有一定影响</li>
                        <li><span class="font-medium">偏重：</span>自觉有该项症状，对受检者有相当程度的影响</li>
                        <li><span class="font-medium">严重：</span>自觉该症状的频度和强度都十分严重，对受检者的影响严重</li>
                    </ul>
                </div>
                
                <!-- 注意事项 -->
                <div class="bg-white rounded-xl p-6">
                    <h3 class="text-xl font-semibold mb-4">注意事项</h3>
                    <ul class="list-disc list-inside text-muted space-y-2">
                        <li>本测试仅供参考，不能替代专业的心理咨询或诊断</li>
                        <li>测试结果仅反映当前的心理状态，随着时间和环境的变化可能会有所不同</li>
                        <li>请根据您的实际情况如实回答，以获得更准确的评估结果</li>
                        <li>如果您的测试结果显示存在较严重的心理问题，建议及时寻求专业心理咨询师或医生的帮助</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 测试页面 -->
        <div id="test-page" class="hidden">
            <!-- 三端容器适配 -->
            <div class="max-w-xs xs:max-w-sm sm:max-w-md md:max-w-lg lg:max-w-xl mx-auto pt-6">
                <!-- 进度条 -->
                <div class="mb-4 xs:mb-5 sm:mb-6 lg:mb-7">
                    <div class="flex justify-between text-sm sm:text-base text-muted mb-2">
                        <span>第 <span id="current-question">1</span> 题</span>
                        <span>共 90 题</span>
                    </div>
                    <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
                        <div id="progress-bar" class="h-full bg-primary rounded-full transition-smooth" style="width: 1%"></div>
                    </div>
                </div>
                
                <!-- 题目卡片 -->
                <div class="bg-white rounded-16 p-3 xs:p-4 sm:p-5 lg:p-6 card-shadow">
                    <h2 id="question-text" class="text-base xs:text-lg sm:text-xl lg:text-2xl font-medium mb-4 xs:mb-5 sm:mb-6">题目将在这里显示</h2>
                    
                    <!-- 选项 - 三端间距适配 -->
                    <div class="space-y-2 xs:space-y-2.5 sm:space-y-3 mb-4 xs:mb-5 sm:mb-6">
                        <div class="option-item" data-score="1">
                            <div class="flex items-center">
                                <div class="w-5 xs:w-6 sm:w-7 h-5 xs:h-6 sm:h-7 rounded-full border border-gray-300 flex items-center justify-center mr-3 xs:mr-3.5 sm:mr-4 option-indicator">
                                    <div class="w-3 xs:w-3.5 sm:w-4 h-3 xs:h-3.5 sm:h-4 rounded-full bg-primary hidden option-check"></div>
                                </div>
                                <span class="text-sm xs:text-base sm:text-lg">从无</span>
                            </div>
                        </div>
                        <div class="option-item" data-score="2">
                            <div class="flex items-center">
                                <div class="w-5 xs:w-6 sm:w-7 h-5 xs:h-6 sm:h-7 rounded-full border border-gray-300 flex items-center justify-center mr-3 xs:mr-3.5 sm:mr-4 option-indicator">
                                    <div class="w-3 xs:w-3.5 sm:w-4 h-3 xs:h-3.5 sm:h-4 rounded-full bg-primary hidden option-check"></div>
                                </div>
                                <span class="text-sm xs:text-base sm:text-lg">很轻</span>
                            </div>
                        </div>
                        <div class="option-item" data-score="3">
                            <div class="flex items-center">
                                <div class="w-5 xs:w-6 sm:w-7 h-5 xs:h-6 sm:h-7 rounded-full border border-gray-300 flex items-center justify-center mr-3 xs:mr-3.5 sm:mr-4 option-indicator">
                                    <div class="w-3 xs:w-3.5 sm:w-4 h-3 xs:h-3.5 sm:h-4 rounded-full bg-primary hidden option-check"></div>
                                </div>
                                <span class="text-sm xs:text-base sm:text-lg">中等</span>
                            </div>
                        </div>
                        <div class="option-item" data-score="4">
                            <div class="flex items-center">
                                <div class="w-5 xs:w-6 sm:w-7 h-5 xs:h-6 sm:h-7 rounded-full border border-gray-300 flex items-center justify-center mr-3 xs:mr-3.5 sm:mr-4 option-indicator">
                                    <div class="w-3 xs:w-3.5 sm:w-4 h-3 xs:h-3.5 sm:h-4 rounded-full bg-primary hidden option-check"></div>
                                </div>
                                <span class="text-sm xs:text-base sm:text-lg">偏重</span>
                            </div>
                        </div>
                        <div class="option-item" data-score="5">
                            <div class="flex items-center">
                                <div class="w-5 xs:w-6 sm:w-7 h-5 xs:h-6 sm:h-7 rounded-full border border-gray-300 flex items-center justify-center mr-3 xs:mr-3.5 sm:mr-4 option-indicator">
                                    <div class="w-3 xs:w-3.5 sm:w-4 h-3 xs:h-3.5 sm:h-4 rounded-full bg-primary hidden option-check"></div>
                                </div>
                                <span class="text-sm xs:text-base sm:text-lg">严重</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 提示 -->
                    <div class="text-sm sm:text-base text-muted text-center mb-2 sm:mb-0">
                        选择后将自动跳转到下一题（最后一题除外）
                    </div>
                </div>
                
                <!-- 按钮 -->
                <div class="flex justify-between mt-3 xs:mt-4 sm:mt-5 lg:mt-6">
                    <button id="prev-btn" class="bg-light hover:bg-light/80 text-text py-2.5 xs:py-3 sm:py-3.5 px-4 xs:px-5 sm:px-7 rounded-12 font-medium transition-smooth disabled:opacity-50 disabled:cursor-not-allowed text-sm" disabled>
                        <i class="fa fa-arrow-left mr-1.5"></i> 上一题
                    </button>
                    <button id="next-btn" class="bg-primary/20 text-primary py-2.5 xs:py-3 sm:py-3.5 px-4 xs:px-5 sm:px-7 rounded-12 font-medium transition-smooth text-sm" disabled>
                        下一题
                        <i class="fa fa-arrow-right ml-1.5"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 结果页面 -->
        <div id="result-page" class="hidden">
            <!-- 三端容器适配 -->
            <div class="max-w-xs xs:max-w-sm sm:max-w-2xl md:max-w-3xl lg:max-w-4xl mx-auto">
                <!-- 页面标题 -->
                <div class="text-center my-6 sm:my-8">
                    <div class="flex items-center justify-center mb-3 sm:mb-4">
                        <div class="w-10 sm:w-12 h-10 sm:h-12 bg-secondary/10 rounded-full flex items-center justify-center mr-3 sm:mr-4">
                            <i class="fa fa-check text-lg sm:text-xl text-secondary"></i>
                        </div>
                        <h2 class="text-xl sm:text-2xl md:text-3xl font-bold">SCL-90症状自评量表</h2>
                    </div>
                    <p class="text-muted text-sm sm:text-base">测试结果仅供参考，不作诊断依据</p>
                </div>
                

                
                <!-- 总分和总均分 -->
                <div class="bg-white rounded-xl p-5 sm:p-6 card-shadow mb-6 sm:mb-8">
                    <h3 class="text-lg sm:text-xl font-semibold mb-4 sm:mb-6 text-center">总体评估</h3>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6">
                        <div class="bg-light rounded-xl p-4 sm:p-5 text-center">
                            <p class="text-sm sm:text-base text-muted mb-2">总分</p>
                            <p id="total-score" class="text-2xl sm:text-3xl md:text-4xl font-bold text-primary">256</p>
                            <p id="total-score-interpretation" class="text-sm mt-2 font-medium text-green-600">可能存在轻度心理问题</p>
                        </div>
                        
                        <div class="bg-light rounded-xl p-4 sm:p-5 text-center">
                            <p class="text-sm sm:text-base text-muted mb-2">总均分</p>
                            <p id="total-index" class="text-2xl sm:text-3xl md:text-4xl font-bold text-primary">2.84</p>
                            <p id="total-index-interpretation" class="text-sm mt-2 font-medium text-yellow-600">存在中等程度症状</p>
                        </div>
                    </div>
                    
                    <div class="mt-4 sm:mt-6 text-center">
                        <div id="overall-assessment" class="text-sm sm:text-base text-muted max-w-md mx-auto">
                            您可能存在轻度的心理问题，建议关注自己的心理健康，适当调整生活方式，必要时可以寻求心理咨询师的帮助。
                        </div>
                    </div>
                </div>
                
                <!-- 主要问题领域 -->
                <div class="bg-white rounded-xl p-5 sm:p-6 card-shadow mb-6 sm:mb-8">
                    <h3 class="text-lg sm:text-xl font-semibold mb-4 sm:mb-6">主要问题领域</h3>
                    <div id="main-issues-container" class="space-y-4">
                        <!-- 主要问题领域将在这里动态生成 -->
                    </div>
                </div>
                
                <!-- 因子得分雷达图 -->
                <div class="bg-white rounded-xl p-5 sm:p-6 card-shadow mb-6 sm:mb-8">
                    <h3 class="text-lg sm:text-xl font-semibold mb-1 sm:mb-2">各因子得分分布</h3>
                    <div class="flex justify-center">
                        <div class="w-full max-w-md sm:max-w-lg">
                            <canvas id="factor-chart" class="w-full h-64 sm:h-80"></canvas>
                        </div>
                    </div>
                    <div class="mt-0.5 text-center text-sm text-muted">
                        <p>雷达图显示了您在各个心理维度上的得分情况</p>
                    </div>
                </div>
                
                <!-- 各因子得分情况 -->
                <div class="bg-white rounded-xl p-5 sm:p-6 card-shadow mb-6 sm:mb-8">
                    <h3 class="text-lg sm:text-xl font-semibold mb-4 sm:mb-6">各因子得分详情</h3>
                    
                    <!-- 因子得分表格 -->
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm sm:text-base">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="py-3 px-2 sm:px-4 text-left font-medium text-muted">因子名称</th>
                                    <th class="py-3 px-2 sm:px-4 text-center font-medium text-muted">得分</th>
                                    <th class="py-3 px-2 sm:px-4 text-center font-medium text-muted">平均分</th>
                                    <th class="py-3 px-2 sm:px-4 text-center font-medium text-muted">测试情况</th>
                                </tr>
                            </thead>
                            <tbody id="factors-table-body" class="divide-y divide-gray-100 bg-white">
                                <!-- 因子得分将在这里动态生成 -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- 因子解释说明 -->
                <div class="bg-white rounded-xl p-5 sm:p-6 card-shadow mb-6 sm:mb-8">
                    <h3 class="text-lg sm:text-xl font-semibold mb-4 sm:mb-6">因子详细解释</h3>
                    <div id="factors-interpretation" class="space-y-4">
                        <!-- 因子解释将在这里动态生成 -->
                    </div>
                </div>
                
                <!-- 专业建议 -->
                <div class="bg-white rounded-xl p-5 sm:p-6 card-shadow mb-6 sm:mb-8">
                    <h3 class="text-lg sm:text-xl font-semibold mb-4 sm:mb-6">专业建议</h3>
                    <div id="professional-advice" class="text-sm sm:text-base space-y-4">--</div>
                </div>
                
                <!-- 结果操作按钮 -->
                <div class="text-center mb-8 sm:mb-12">
                    <button id="restart-btn" class="bg-primary hover:bg-primary/90 text-white py-3 px-8 rounded-xl font-medium transition-smooth text-base sm:text-lg shadow-lg shadow-primary/20 hover:shadow-primary/30 inline-flex items-center">
                        重新测试
                        <i class="fa fa-refresh ml-2"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 我的页面 -->
        <div id="history-page" class="hidden">
            <!-- 三端容器适配 -->
            <div class="max-w-xs xs:max-w-sm sm:max-w-2xl md:max-w-3xl lg:max-w-4xl mx-auto">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold mb-2">我的测试记录</h2>
                    <p class="text-muted">查看您的历史测试数据</p>
                </div>
                
                <!-- 历史记录列表 -->
                <div id="history-list" class="space-y-3 xs:space-y-4 mb-6">
                    <!-- 历史记录将在这里动态生成 -->
                    <div class="bg-white rounded-xl p-4 card-shadow text-center text-muted">
                        暂无测试记录
                    </div>
                </div>
                
                <!-- 开始新测试按钮 -->
                <div class="text-center">
                    <button id="new-test-btn" class="bg-primary hover:bg-primary/90 text-white py-3 px-6 rounded-xl font-medium transition-smooth text-base inline-flex items-center">
                        开始新测试
                        <i class="fa fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 资源页面 -->
        <div id="resource-page" class="hidden">
            <!-- 三端容器适配 -->
            <div class="max-w-xs xs:max-w-sm sm:max-w-2xl md:max-w-3xl lg:max-w-4xl mx-auto">
                <div class="flex items-center mb-4 xs:mb-6">
                    <button id="back-to-result-btn" class="mr-3 text-muted hover:text-primary">
                        <i class="fa fa-arrow-left text-lg"></i>
                    </button>
                    <h2 class="text-xl xs:text-2xl font-bold">心理健康资源</h2>
                </div>
                
                <!-- 资源卡片 -->
                <div class="bg-white rounded-xl p-4 xs:p-5 sm:p-6 card-shadow mb-3 xs:mb-4 sm:mb-6">
                    <h3 class="text-base xs:text-lg sm:text-xl font-semibold mb-3 xs:mb-4">自助资源</h3>
                    <div class="space-y-3 xs:space-y-4">
                        <a href="#" class="block p-3 xs:p-4 bg-light rounded-xl hover:bg-light/80 transition-smooth">
                            <div class="flex items-center">
                                <div class="bg-primary/10 rounded-full p-2 mr-3">
                                    <i class="fa fa-book text-primary"></i>
                                </div>
                                <div>
                                    <h4 class="font-medium">心理健康书籍推荐</h4>
                                    <p class="text-sm text-muted">精选有助于心理健康的书籍列表</p>
                                </div>
                            </div>
                        </a>
                        <a href="#" class="block p-3 xs:p-4 bg-light rounded-xl hover:bg-light/80 transition-smooth">
                            <div class="flex items-center">
                                <div class="bg-primary/10 rounded-full p-2 mr-3">
                                    <i class="fa fa-headphones text-primary"></i>
                                </div>
                                <div>
                                    <h4 class="font-medium">冥想与放松指导</h4>
                                    <p class="text-sm text-muted">帮助您缓解压力的冥想练习</p>
                                </div>
                            </div>
                        </a>
                        <a href="#" class="block p-3 xs:p-4 bg-light rounded-xl hover:bg-light/80 transition-smooth">
                            <div class="flex items-center">
                                <div class="bg-primary/10 rounded-full p-2 mr-3">
                                    <i class="fa fa-video-camera text-primary"></i>
                                </div>
                                <div>
                                    <h4 class="font-medium">心理健康视频课程</h4>
                                    <p class="text-sm text-muted">专业的心理健康知识与技能培训</p>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
                
                <!-- 专业帮助 -->
                <div class="bg-white rounded-xl p-4 xs:p-5 sm:p-6 card-shadow">
                    <h3 class="text-base xs:text-lg sm:text-xl font-semibold mb-3 xs:mb-4">专业帮助</h3>
                    <p class="text-muted text-sm xs:text-base mb-3 xs:mb-4">如果您需要专业的心理帮助，可以考虑以下途径：</p>
                    <div class="space-y-3 xs:space-y-4">
                        <div class="p-3 xs:p-4 bg-light rounded-xl">
                            <h4 class="font-medium">心理咨询热线</h4>
                            <p class="text-sm text-muted">全国心理危机干预热线：400-161-9995</p>
                            <p class="text-sm text-muted">北京心理援助热线：010-82951332</p>
                        </div>
                        <div class="p-3 xs:p-4 bg-light rounded-xl">
                            <h4 class="font-medium">在线心理咨询平台</h4>
                            <p class="text-sm text-muted">壹心理：https://www.xinli001.com</p>
                            <p class="text-sm text-muted">简单心理：https://www.jiandanxinli.com</p>
                        </div>
                        <div class="p-3 xs:p-4 bg-light rounded-xl">
                            <h4 class="font-medium">医院心理科</h4>
                            <p class="text-sm text-muted">建议前往当地三甲医院心理科或精神科就诊</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 页面底部重要提示 -->
    <div class="bg-amber-50 border-l-4 border-amber-400 p-4 my-6 rounded-lg max-w-4xl mx-auto px-4 xs:px-4 sm:px-6 md:px-6 lg:px-8">
        <div class="flex">
            <div class="flex-shrink-0">
                <i class="fa fa-exclamation-triangle text-amber-400"></i>
            </div>
            <div class="ml-3">
                <p class="text-sm text-amber-700">
                    <strong>重要提示：</strong>本测试仅供参考，不能替代专业的心理咨询或诊断。如果您的测试结果显示存在较严重的心理问题，建议及时寻求专业心理咨询师或医生的帮助。
                </p>
            </div>
        </div>
    </div>

    <!-- 底部导航栏（移动端） -->
    <footer class="lg:hidden bg-white border-t border-gray-100 py-2 fixed bottom-0 left-0 right-0 z-40">
        <div class="flex justify-around">
            <button class="nav-btn flex flex-col items-center py-2 px-4 text-primary" data-target="home-page">
                <i class="fa fa-home text-lg"></i>
                <span class="text-xs mt-1">首页</span>
            </button>
            <button class="nav-btn flex flex-col items-center py-2 px-4 text-muted" data-target="about-page">
                <i class="fa fa-info-circle text-lg"></i>
                <span class="text-xs mt-1">关于</span>
            </button>
            <button class="nav-btn flex flex-col items-center py-2 px-4 text-muted" data-target="result-page" id="my-button">
                <i class="fa fa-user text-lg"></i>
                <span class="text-xs mt-1">我的</span>
            </button>
        </div>
    </footer>

    <!-- 页脚 -->
    <footer class="bg-white border-t border-gray-100 py-2">
        <div class="container mx-auto px-4 text-center">
            <div class="flex items-center justify-center mb-1">
                <div class="w-5 h-5 bg-primary rounded-full flex items-center justify-center mr-1">
                    <span class="text-white text-[10px] font-bold">S</span>
                </div>
                <h2 class="text-base font-bold">SOULTEST</h2>
            </div>
            <p class="text-muted text-[10px]">© 2025 SOULTEST. 保留所有权利。</p>
            <!-- 社交媒体图标已移除 -->
        </div>
    </footer>

    <script>
        // SCL-90 题目数据（标准90题版本）
        const questions = [
            // 躯体化 (12项) - 因子0 (题号: 1,4,12,27,40,42,48,49,52,53,56,58)
            { text: "头痛", factor: 0 },
            { text: "头昏或晕倒", factor: 0 },
            { text: "胸痛", factor: 0 },
            { text: "腰痛", factor: 0 },
            { text: "恶心或胃部不舒服", factor: 0 },
            { text: "肌肉酸痛", factor: 0 },
            { text: "呼吸有困难", factor: 0 },
            { text: "一阵阵发冷或发热", factor: 0 },
            { text: "身体发麻或刺痛", factor: 0 },
            { text: "喉咙有梗塞感", factor: 0 },
            { text: "感到身体的某一部分软弱无力", factor: 0 },
            { text: "感到手或脚发重", factor: 0 },
            
            // 强迫症状 (10项) - 因子1 (题号: 3,9,10,28,38,45,46,51,55,65)
            { text: "头脑中有不必要的想法或字句盘旋", factor: 1 },
            { text: "忘性大", factor: 1 },
            { text: "担心自己的衣饰整齐及仪态的端正", factor: 1 },
            { text: "感到难以完成任务", factor: 1 },
            { text: "做事必须做得很慢以保证做得正确", factor: 1 },
            { text: "做事必须反复检查", factor: 1 },
            { text: "难以作出决定", factor: 1 },
            { text: "脑子变空了", factor: 1 },
            { text: "不能集中注意力", factor: 1 },
            { text: "必须反复洗手、点数目或触摸某些东西", factor: 1 },
            
            // 人际关系敏感 (9项) - 因子2 (题号: 6,21,34,36,37,41,61,69,73)
            { text: "对旁人责备求全", factor: 2 },
            { text: "同异性相处时感到害羞不自在", factor: 2 },
            { text: "感情容易受到伤害", factor: 2 },
            { text: "感到别人不理解您、不同情您", factor: 2 },
            { text: "感到人们对您不友好、不喜欢您", factor: 2 },
            { text: "感到比不上他人", factor: 2 },
            { text: "当别人看着您或谈论您时感到不自在", factor: 2 },
            { text: "感到对别人神经过敏", factor: 2 },
            { text: "感到在公共场合吃东西很不舒服", factor: 2 },
            
            // 抑郁 (13项) - 因子3 (题号: 5,14,15,20,22,26,29,30,31,32,54,71,79)
            { text: "对异性的兴趣减退", factor: 3 },
            { text: "感到自己的精力下降，活动减慢", factor: 3 },
            { text: "想结束自己的生命", factor: 3 },
            { text: "容易哭泣", factor: 3 },
            { text: "感到受骗，中了圈套或有人想抓住您", factor: 3 },
            { text: "经常责怪自己", factor: 3 },
            { text: "感到孤独", factor: 3 },
            { text: "感到苦闷", factor: 3 },
            { text: "过分担忧", factor: 3 },
            { text: "对事物不感兴趣", factor: 3 },
            { text: "感到前途没有希望", factor: 3 },
            { text: "感到任何事情都很困难", factor: 3 },
            { text: "感到自己没有什么价值", factor: 3 },
            
            // 焦虑 (10项) - 因子4 (题号: 2,17,23,33,39,57,72,78,80,86)
            { text: "神经过敏，心中不踏实", factor: 4 },
            { text: "发抖", factor: 4 },
            { text: "无缘无故地突然感到害怕", factor: 4 },
            { text: "感到害怕", factor: 4 },
            { text: "心跳得很厉害", factor: 4 },
            { text: "感到紧张或容易紧张", factor: 4 },
            { text: "一阵阵恐惧或惊恐", factor: 4 },
            { text: "感到坐立不安、心神不定", factor: 4 },
            { text: "感到熟悉的东西变成陌生或不像是真的", factor: 4 },
            { text: "感到要很快把事情做完", factor: 4 },
            
            // 敌对 (6项) - 因子5 (题号: 11,24,63,67,74,81)
            { text: "容易烦恼和激动", factor: 5 },
            { text: "自己不能控制地大发脾气", factor: 5 },
            { text: "有想打人或伤害他人的冲动", factor: 5 },
            { text: "有想摔坏或破坏东西的冲动", factor: 5 },
            { text: "经常与人争论", factor: 5 },
            { text: "大叫或摔东西", factor: 5 },
            
            // 恐怖 (7项) - 因子6 (题号: 13,25,47,50,70,75,82)
            { text: "害怕空旷的场所或街道", factor: 6 },
            { text: "怕单独出门", factor: 6 },
            { text: "怕乘电车、公共汽车、地铁或火车", factor: 6 },
            { text: "因为感到害怕而避开某些东西、场合或活动", factor: 6 },
            { text: "在商店或电影院等人多的地方感到不自在", factor: 6 },
            { text: "单独一人时神经很紧张", factor: 6 },
            { text: "害怕会在公共场合晕倒", factor: 6 },
            
            // 偏执 (6项) - 因子7 (题号: 8,18,43,68,76,83)
            { text: "责怪别人制造麻烦", factor: 7 },
            { text: "感到大多数人都不可信任", factor: 7 },
            { text: "感到有人在监视您、谈论您", factor: 7 },
            { text: "有一些别人没有的想法或念头", factor: 7 },
            { text: "别人对您的成绩没有作出恰当的评价", factor: 7 },
            { text: "感到别人想占您的便宜", factor: 7 },
            
            // 精神病性 (10项) - 因子8 (题号: 7,16,35,62,77,84,85,87,88,90)
            { text: "感到别人能控制您的思想", factor: 8 },
            { text: "听到旁人听不到的声音", factor: 8 },
            { text: "旁人能知道您的私下想法", factor: 8 },
            { text: "有一些不属于您自己的想法", factor: 8 },
            { text: "即使和别人在一起也感到孤单", factor: 8 },
            { text: "为一些有关“性”的想法而很苦恼", factor: 8 },
            { text: "您认为应该因为自己的过错而受到惩罚", factor: 8 },
            { text: "感到自己的身体有严重问题", factor: 8 },
            { text: "从未感到和其他人很亲近", factor: 8 },
            { text: "感到自己的脑子有毛病", factor: 8 },
            
            // 其他 (7项) - 因子9，主要反映睡眠及饮食情况 (题号: 19,44,59,60,64,66,89)
            { text: "胃口不好", factor: 9 },
            { text: "难以入睡", factor: 9 },
            { text: "想到有关死亡的事", factor: 9 },
            { text: "吃得太多", factor: 9 },
            { text: "醒得太早", factor: 9 },
            { text: "睡得不稳不深", factor: 9 },
            { text: "感到自己有罪", factor: 9 }
        ];

        // 因子名称
        const factorNames = [
            "躯体化",
            "强迫症状",
            "人际关系敏感",
            "抑郁",
            "焦虑",
            "敌对",
            "恐怖",
            "偏执",
            "精神病性",
            "其他"
        ];

        // 因子解释
        const factorInterpretations = [
            "反映身体上的不适症状，如头痛、头晕、胸痛等",
            "反映反复出现的、不必要的想法或行为",
            "反映在人际关系中的不自在感和自卑感",
            "反映抑郁情绪，如对事物失去兴趣、感到孤独等",
            "反映焦虑情绪，如紧张、害怕、担忧等",
            "反映敌对情绪和行为，如容易激动、想打人等",
            "反映对特定事物或情境的恐惧",
            "反映猜疑和偏执的思维方式",
            "反映精神病性症状，如幻觉、妄想等",
            "反映睡眠、饮食等方面的问题"
        ];

        // 页面元素
        const pages = {
            home: document.getElementById('home-page'),
            about: document.getElementById('about-page'),
            test: document.getElementById('test-page'),
            result: document.getElementById('result-page'),
            history: document.getElementById('history-page'),
            resource: document.getElementById('resource-page')
        };

        // 导航元素
        const navItems = {
            home: document.getElementById('nav-home'),
            about: document.getElementById('nav-about'),
            history: document.getElementById('nav-history')
        };

        const mobileNavItems = {
            home: document.getElementById('mobile-nav-home'),
            about: document.getElementById('mobile-nav-about'),
            history: document.getElementById('mobile-nav-history')
        };

        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');

        // 测试相关元素
        const startTestBtn = document.getElementById('start-test-btn');
        const questionText = document.getElementById('question-text');
        const currentQuestionSpan = document.getElementById('current-question');
        const progressBar = document.getElementById('progress-bar');
        const optionItems = document.querySelectorAll('.option-item');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');

        // 结果相关元素
        const resultPage = document.getElementById('result-page');
        const testDateSpan = document.getElementById('test-date');
        const totalScoreSpan = document.getElementById('total-score');
        const positiveCountSpan = document.getElementById('positive-count');
        const totalIndexSpan = document.getElementById('total-index');
        const totalScoreInterpretationSpan = document.getElementById('total-score-interpretation');
        const positiveCountInterpretationSpan = document.getElementById('positive-count-interpretation');
        const totalIndexInterpretationSpan = document.getElementById('total-index-interpretation');
        const overallAssessmentDiv = document.getElementById('overall-assessment');
        const factorsContainer = document.getElementById('factors-container');
        const symptomDistributionDiv = document.getElementById('symptom-distribution');
        const severityDistributionDiv = document.getElementById('severity-distribution');
        const professionalAdviceDiv = document.getElementById('professional-advice');
        const levelBasedAdviceDiv = document.getElementById('level-based-advice');
        const restartBtn = document.getElementById('restart-btn');

        // 资源页面元素
        const resourcePage = document.getElementById('resource-page');
        const backToResultBtn = document.getElementById('back-to-result-btn');

        // 移动端底部导航
        const navBtns = document.querySelectorAll('.nav-btn');
        const myButton = document.getElementById('my-button');

        // 测试状态
        let currentQuestionIndex = 0;
        let answers = [];
        let scores = {
            total: 0,
            factors: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            factorCounts: [12, 10, 9, 13, 10, 6, 7, 6, 10, 7]
        };

        // 初始化
        function init() {
            // 设置导航点击事件
            setupNavigation();
            
            // 设置移动端底部导航点击事件
            setupMobileBottomNav();
            
            // 设置测试相关事件
            setupTestEvents();
            
            // 设置结果相关事件
            setupResultEvents();
            
            // 初始化页面
            showPage('home');
            
            // 检查本地存储中是否有测试结果
            checkForSavedResults();
        }

        // 设置导航点击事件
        function setupNavigation() {
            // 桌面端导航
            navItems.home.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('home');
                updateNavActive('home');
            });
            
            navItems.about.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('about');
                updateNavActive('about');
            });
            
            navItems.history.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('history');
                updateNavActive('history');
                // 加载历史记录
                loadHistoryRecords();
            });
            
            // 移动端导航
            mobileNavItems.home.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('home');
                updateNavActive('home');
                mobileMenu.classList.add('hidden');
            });
            
            mobileNavItems.about.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('about');
                updateNavActive('about');
                mobileMenu.classList.add('hidden');
            });
            
            mobileNavItems.history.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('history');
                updateNavActive('history');
                mobileMenu.classList.add('hidden');
                // 加载历史记录
                loadHistoryRecords();
            });
            
            // 移动端菜单按钮
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
            
            // 开始测试按钮
            startTestBtn.addEventListener('click', () => {
  $('#verify-modal').removeClass('hidden');
});

            
            // 开始新测试按钮
            const newTestBtn = document.getElementById('new-test-btn');
            if (newTestBtn) {
                newTestBtn.addEventListener('click', startTest);
            }
        }

        // 设置移动端底部导航点击事件
        function setupMobileBottomNav() {
            navBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const target = btn.getAttribute('data-target');
                    
                    // 更新按钮样式
                    navBtns.forEach(b => {
                        b.classList.remove('text-primary');
                        b.classList.add('text-muted');
                    });
                    btn.classList.remove('text-muted');
                    btn.classList.add('text-primary');
                    
                    // 显示对应页面
                    if (target === 'home-page') {
                        showPage('home');
                        updateNavActive('home');
                    } else if (target === 'about-page') {
                        showPage('about');
                        updateNavActive('about');
                    } else if (target === 'result-page') {
                        // 显示"我的"页面
                        showPage('history');
                        updateNavActive('history');
                        // 加载历史记录
                        loadHistoryRecords();
                    }
                });
            });
        }

        // 设置测试相关事件
        function setupTestEvents() {
            // 选项点击事件
            optionItems.forEach(item => {
                item.addEventListener('click', () => {
                    // 移除其他选项的选中状态
                    optionItems.forEach(opt => {
                        opt.classList.remove('selected');
                        opt.querySelector('.option-check').classList.add('hidden');
                    });
                    
                    // 添加当前选项的选中状态
                    item.classList.add('selected');
                    item.querySelector('.option-check').classList.remove('hidden');
                    
                    // 保存答案
                    answers[currentQuestionIndex] = parseInt(item.getAttribute('data-score'));
                    
                    // 启用下一题按钮
                    nextBtn.disabled = false;
                    nextBtn.classList.remove('bg-primary/20');
                    nextBtn.classList.add('bg-primary', 'text-white');
                    
                    // 更新按钮文本
                    if (currentQuestionIndex === questions.length - 1) {
                        nextBtn.innerHTML = '提交 <i class="fa fa-check ml-1"></i>';
                    } else {
                        nextBtn.innerHTML = '下一题 <i class="fa fa-arrow-right ml-1"></i>';
                    }
                    
                    // 如果不是最后一题，0.2秒后自动跳转到下一题
                    if (currentQuestionIndex < questions.length - 1) {
                        setTimeout(() => {
                            nextQuestion();
                        }, 200);
                    }
                    // 最后一题不自动跳转，必须点击提交按钮
                });
            });
            
            // 上一题按钮点击事件
            prevBtn.addEventListener('click', () => {
                if (currentQuestionIndex > 0) {
                    currentQuestionIndex--;
                    updateQuestion();
                }
            });
            
            // 下一题按钮点击事件
            nextBtn.addEventListener('click', nextQuestion);
        }

        // 设置结果相关事件
        function setupResultEvents() {
            // 重新测试按钮点击事件
            restartBtn.addEventListener('click', startTest);
            
            // 返回结果按钮点击事件
            backToResultBtn.addEventListener('click', () => {
                showPage('result');
            });
            
            // 保存结果按钮点击事件
            const saveResultBtn = document.getElementById('save-result-btn');
            if (saveResultBtn) {
                saveResultBtn.addEventListener('click', saveTestResult);
            }
        }
        
        // 保存测试结果
        function saveTestResult() {
            // 获取当前日期
            const now = new Date();
            const dateString = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            
            // 准备要保存的数据
            const resultData = {
                date: dateString,
                answers: [...answers],
                scores: {
                    total: scores.total,
                    factors: [...scores.factors]
                }
            };
            
            // 获取已保存的历史记录
            let historyRecords = JSON.parse(localStorage.getItem('scl90History')) || [];
            
            // 添加新记录到历史记录
            historyRecords.push(resultData);
            
            // 保存到本地存储
            localStorage.setItem('scl90History', JSON.stringify(historyRecords));
            
            // 显示保存成功提示
            alert('测试结果已保存');
            
            // 跳转到"我的"页面
            showPage('history');
            updateNavActive('history');
            loadHistoryRecords();
        }
        
        // 加载历史记录
        function loadHistoryRecords() {
            const historyList = document.getElementById('history-list');
            if (!historyList) return;
            
            // 获取已保存的历史记录
            const historyRecords = JSON.parse(localStorage.getItem('scl90History')) || [];
            
            // 清空历史记录列表
            historyList.innerHTML = '';
            
            if (historyRecords.length === 0) {
                // 显示暂无记录提示
                historyList.innerHTML = `
                    <div class="bg-white rounded-xl p-4 card-shadow text-center text-muted">
                        暂无测试记录
                    </div>
                `;
                return;
            }
            
            // 按时间倒序排列
            historyRecords.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // 生成历史记录列表
            historyRecords.forEach((record, index) => {
                // 计算总分
                const totalScore = record.scores.total;
                
                // 计算总均分
                const totalIndex = (totalScore / questions.length).toFixed(2);
                
                // 创建历史记录项
                const recordItem = document.createElement('div');
                recordItem.className = 'bg-white rounded-xl p-4 card-shadow';
                recordItem.innerHTML = `
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-medium">测试 #${historyRecords.length - index}</h3>
                        <span class="text-xs text-muted">${record.date}</span>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-card rounded-xl p-3 text-center shadow-sm">
                            <p class="text-xs text-muted mb-1">总分</p>
                            <p class="text-lg font-bold">${totalScore}</p>
                        </div>
                        <div class="bg-card rounded-xl p-3 text-center shadow-sm">
                            <p class="text-xs text-muted mb-1">总均分</p>
                            <p class="text-lg font-bold">${totalIndex}</p>
                        </div>
                    </div>
                    <div class="mt-3 text-center">
                        <button class="view-result-btn bg-light hover:bg-light/80 text-text py-2 px-4 rounded-xl font-medium transition-smooth text-sm" data-index="${index}">
                            查看详情
                        </button>
                    </div>
                `;
                
                // 添加到历史记录列表
                historyList.appendChild(recordItem);
                
                // 添加查看详情按钮点击事件
                const viewBtn = recordItem.querySelector('.view-result-btn');
                viewBtn.addEventListener('click', () => {
                    // 加载选中的历史记录
                    loadHistoryResult(index);
                });
            });
        }
        
        // 加载历史测试结果
        function loadHistoryResult(index) {
            // 获取已保存的历史记录
            const historyRecords = JSON.parse(localStorage.getItem('scl90History')) || [];
            
            if (index >= 0 && index < historyRecords.length) {
                const record = historyRecords[index];
                
                // 恢复测试数据
                answers = [...record.answers];
                scores = {
                    total: record.scores.total,
                    factors: [...record.scores.factors],
                    factorCounts: [12, 10, 9, 13, 10, 6, 7, 6, 10, 7]
                };
                
                // 显示结果页面
                showPage('result');
                
                // 生成结果
                generateResults();
            }
        }

        // 显示指定页面
        function showPage(pageName) {
            // 隐藏所有页面
            Object.values(pages).forEach(page => {
                page.classList.add('hidden');
            });
            
            // 显示指定页面
            pages[pageName].classList.remove('hidden');
            
            // 如果是结果页面，生成结果
            if (pageName === 'result') {
                generateResults();
            }
        }

        // 更新导航活动状态
        function updateNavActive(activeNav) {
            // 桌面端导航
            Object.entries(navItems).forEach(([key, item]) => {
                if (key === activeNav) {
                    item.classList.add('nav-item-active');
                    item.classList.remove('text-muted', 'border-transparent', 'hover:border-primary/30');
                } else {
                    item.classList.remove('nav-item-active');
                    item.classList.add('text-muted', 'border-transparent', 'hover:border-primary/30');
                }
            });
            
            // 移动端导航
            Object.entries(mobileNavItems).forEach(([key, item]) => {
                if (key === activeNav) {
                    item.classList.add('bg-primary/5', 'text-primary', 'font-medium');
                } else {
                    item.classList.remove('bg-primary/5', 'text-primary', 'font-medium');
                }
            });
            
            // 移动端底部导航
            navBtns.forEach((btn, index) => {
                if ((index === 0 && activeNav === 'home') || 
                    (index === 1 && activeNav === 'about') || 
                    (index === 2 && activeNav === 'history')) {
                    btn.classList.remove('text-muted');
                    btn.classList.add('text-primary');
                } else {
                    btn.classList.remove('text-primary');
                    btn.classList.add('text-muted');
                }
            });
        }

        // 开始测试
        function startTest() {
            // 重置测试状态
            currentQuestionIndex = 0;
            answers = new Array(questions.length).fill(0);
            
            // 显示测试页面
            showPage('test');
            
            // 更新第一个问题
            updateQuestion();
        }

        // 更新问题显示
        function updateQuestion() {
            // 更新问题文本
            questionText.textContent = questions[currentQuestionIndex].text;
            
            // 更新当前问题编号
            currentQuestionSpan.textContent = currentQuestionIndex + 1;
            
            // 更新进度条
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            progressBar.style.width = `${progress}%`;
            
            // 更新选项状态
            optionItems.forEach(item => {
                const score = parseInt(item.getAttribute('data-score'));
                if (answers[currentQuestionIndex] === score) {
                    item.classList.add('selected');
                    item.querySelector('.option-check').classList.remove('hidden');
                } else {
                    item.classList.remove('selected');
                    item.querySelector('.option-check').classList.add('hidden');
                }
            });
            
            // 更新按钮状态
            prevBtn.disabled = currentQuestionIndex === 0;
            
            if (answers[currentQuestionIndex] > 0) {
                nextBtn.disabled = false;
                nextBtn.classList.remove('bg-primary/20');
                nextBtn.classList.add('bg-primary', 'text-white');
                
                // 如果是最后一题，修改按钮文本为"提交"
                if (currentQuestionIndex === questions.length - 1) {
                    nextBtn.innerHTML = '提交 <i class="fa fa-check ml-1"></i>';
                } else {
                    nextBtn.innerHTML = '下一题 <i class="fa fa-arrow-right ml-1"></i>';
                }
            } else {
                nextBtn.disabled = true;
                nextBtn.classList.remove('bg-primary', 'text-white');
                nextBtn.classList.add('bg-primary/20');
                nextBtn.innerHTML = '下一题 <i class="fa fa-arrow-right ml-1"></i>';
            }
        }

        // 下一题
        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                updateQuestion();
            } else {
                // 计算得分
                calculateScores();
                
                // 保存结果到本地存储
                saveResults();
                
                // 显示结果页面
                showPage('result');
                
                // 更新移动端底部导航
                navBtns.forEach(btn => {
                    btn.classList.remove('text-primary');
                    btn.classList.add('text-muted');
                });
                myButton.classList.remove('text-muted');
                myButton.classList.add('text-primary');
            }
        }

        // 计算得分
        function calculateScores() {
            // 初始化得分
            scores.total = 0;
            scores.factors = [0, 0, 0, 0, 0, 0, 0, 0, 0];
            
            // 计算总分和因子分
            for (let i = 0; i < questions.length; i++) {
                const score = answers[i];
                scores.total += score;
                
                const factor = questions[i].factor;
                scores.factors[factor] += score;
            }
        }

        // 保存结果到本地存储
        function saveResults() {
            const results = {
                date: new Date().toLocaleString(),
                answers: answers,
                scores: scores
            };
            
            localStorage.setItem('scl90Results', JSON.stringify(results));
        }

        // 检查本地存储中是否有测试结果
        function checkForSavedResults() {
            const savedResults = localStorage.getItem('scl90Results');
            if (savedResults) {
                // 有保存的结果，启用"我的"按钮
                myButton.addEventListener('click', () => {
                    showPage('result');
                    
                    // 更新移动端底部导航样式
                    navBtns.forEach(btn => {
                        btn.classList.remove('text-primary');
                        btn.classList.add('text-muted');
                    });
                    myButton.classList.remove('text-muted');
                    myButton.classList.add('text-primary');
                });
            } else {
                // 没有保存的结果，禁用"我的"按钮
                myButton.addEventListener('click', () => {
                    alert('您还没有完成测试，请先完成测试');
                });
            }
        }

        // 生成结果
        function generateResults() {
            // 获取保存的结果
            const savedResults = localStorage.getItem('scl90Results');
            
            // 如果没有保存的结果，使用模拟数据
            if (!savedResults) {
                // 模拟测试结果数据
                answers = Array(90).fill(1); // 默认所有题目选择"从无"
                
                // 模拟一些有症状的回答
                // 躯体化 (因子0) - 中等程度症状
                for (let i = 0; i < 12; i++) {
                    answers[i] = 2 + Math.floor(Math.random() * 2); // 2-3分
                }
                
                // 强迫症状 (因子1) - 轻度症状
                for (let i = 12; i < 22; i++) {
                    answers[i] = 1 + Math.floor(Math.random() * 2); // 1-2分
                }
                
                // 人际关系敏感 (因子2) - 明显症状
                for (let i = 22; i < 31; i++) {
                    answers[i] = 3 + Math.floor(Math.random() * 2); // 3-4分
                }
                
                // 抑郁 (因子3) - 明显症状
                for (let i = 31; i < 44; i++) {
                    answers[i] = 3 + Math.floor(Math.random() * 2); // 3-4分
                }
                
                // 焦虑 (因子4) - 中等程度症状
                for (let i = 44; i < 54; i++) {
                    answers[i] = 2 + Math.floor(Math.random() * 2); // 2-3分
                }
                
                // 敌对 (因子5) - 轻度症状
                for (let i = 54; i < 60; i++) {
                    answers[i] = 1 + Math.floor(Math.random() * 2); // 1-2分
                }
                
                // 恐怖 (因子6) - 轻度症状
                for (let i = 60; i < 67; i++) {
                    answers[i] = 1 + Math.floor(Math.random() * 2); // 1-2分
                }
                
                // 偏执 (因子7) - 中等程度症状
                for (let i = 67; i < 73; i++) {
                    answers[i] = 2 + Math.floor(Math.random() * 2); // 2-3分
                }
                
                // 精神病性 (因子8) - 轻度症状
                for (let i = 73; i < 83; i++) {
                    answers[i] = 1 + Math.floor(Math.random() * 2); // 1-2分
                }
                
                // 其他 (因子9) - 中等程度症状
                for (let i = 83; i < 90; i++) {
                    answers[i] = 2 + Math.floor(Math.random() * 2); // 2-3分
                }
                
                // 计算得分
                calculateScores();
                
                // 保存到本地存储
                saveResults();
            } else {
                const results = JSON.parse(savedResults);
                answers = results.answers;
                scores = results.scores;
            }
            

            
            // 更新总分
            totalScoreSpan.textContent = scores.total;
            
            // 更新阳性项目数
            const positiveCount = answers.filter(score => score >= 2).length;
            if (positiveCountSpan) {
                positiveCountSpan.textContent = positiveCount;
            }
            
            // 更新总均分
            const totalIndex = (scores.total / questions.length).toFixed(2);
            totalIndexSpan.textContent = totalIndex;
            
            // 更新总分解释
            let totalScoreInterpretation = '';
            if (scores.total <= 160) {
                totalScoreInterpretation = '心理健康状况良好';
            } else if (scores.total <= 240) {
                totalScoreInterpretation = '可能存在轻度心理问题';
            } else {
                totalScoreInterpretation = '可能存在较明显的心理问题';
            }
            if (totalScoreInterpretationSpan) {
                totalScoreInterpretationSpan.textContent = totalScoreInterpretation;
            }
            
            // 更新总分圆环进度条
            updateScoreCircle(scores.total);
            
            // 更新总体评价
            let overallAssessment = '';
            if (scores.total <= 160 && positiveCount <= 43 && parseFloat(totalIndex) <= 2) {
                overallAssessment = '您的心理健康状况良好，没有明显的心理症状。建议继续保持良好的生活习惯和心态，定期进行自我评估。';
            } else if (scores.total <= 240 && positiveCount <= 60 && parseFloat(totalIndex) <= 3) {
                overallAssessment = '您可能存在轻度的心理问题，建议关注自己的心理健康，适当调整生活方式，必要时可以寻求心理咨询师的帮助。';
            } else {
                overallAssessment = '您可能存在较明显的心理问题，建议及时寻求专业心理咨询师或医生的帮助，进行更详细的评估和干预。';
            }
            if (overallAssessmentDiv) {
                overallAssessmentDiv.textContent = overallAssessment;
            }
            
            // 计算因子分
            const factorScores = [];
            for (let i = 0; i < scores.factors.length; i++) {
                const factorScore = (scores.factors[i] / scores.factorCounts[i]).toFixed(2);
                factorScores.push(parseFloat(factorScore));
            }
            
            // 更新因子得分表格
            const factorsTableBody = document.getElementById('factors-table-body');
            if (factorsTableBody) {
                factorsTableBody.innerHTML = '';
                
                for (let i = 0; i < scores.factors.length; i++) {
                    const factorScore = (scores.factors[i] / scores.factorCounts[i]).toFixed(2);
                    
                    // 创建表格行
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 transition-smooth';
                    
                    // 因子名称
                    const nameCell = document.createElement('td');
                    nameCell.className = 'py-3 px-2 sm:px-4 text-left';
                    nameCell.textContent = factorNames[i];
                    row.appendChild(nameCell);
                    
                    // 得分
                    const scoreCell = document.createElement('td');
                    scoreCell.className = 'py-3 px-2 sm:px-4 text-center';
                    scoreCell.textContent = scores.factors[i];
                    row.appendChild(scoreCell);
                    
                    // 平均分
                    const avgCell = document.createElement('td');
                    avgCell.className = 'py-3 px-2 sm:px-4 text-center';
                    avgCell.textContent = factorScore;
                    row.appendChild(avgCell);
                    
                    // 测试情况
                    const statusCell = document.createElement('td');
                    statusCell.className = 'py-3 px-2 sm:px-4 text-center';
                    
                    let status = '';
                    let statusClass = '';
                    
                    if (parseFloat(factorScore) <= 2) {
                        status = '正常';
                        statusClass = 'bg-green-100 text-green-800';
                    } else if (parseFloat(factorScore) <= 3) {
                        status = '轻度';
                        statusClass = 'bg-yellow-100 text-yellow-800';
                    } else {
                        status = '明显';
                        statusClass = 'bg-red-100 text-red-800';
                    }
                    
                    const statusSpan = document.createElement('span');
                    statusSpan.className = `px-2 sm:px-3 py-1 rounded-full text-xs font-medium ${statusClass}`;
                    statusSpan.textContent = status;
                    
                    statusCell.appendChild(statusSpan);
                    row.appendChild(statusCell);
                    
                    // 添加到表格
                    factorsTableBody.appendChild(row);
                }
            }
            
            // 更新主要问题领域
            updateMainIssues(factorScores);
            
            // 更新因子解释说明
            const factorsInterpretation = document.getElementById('factors-interpretation');
            if (factorsInterpretation) {
                factorsInterpretation.innerHTML = '';
                
                // 根据因子得分动态生成解释说明
                for (let i = 0; i < factorNames.length; i++) {
                    const factorScore = (scores.factors[i] / scores.factorCounts[i]).toFixed(2);
                    const scoreLevel = parseFloat(factorScore);
                    
                    // 只显示得分较高的因子
                    if (scoreLevel > 2) {
                        const interpretationItem = document.createElement('div');
                        interpretationItem.className = 'bg-white rounded-xl p-4 border border-gray-100 shadow-sm hover:shadow-md transition-smooth';
                        
                        const factorHeader = document.createElement('div');
                        factorHeader.className = 'flex justify-between items-center mb-3';
                        
                        const factorNameElement = document.createElement('h4');
                        factorNameElement.className = 'font-medium';
                        factorNameElement.textContent = factorNames[i];
                        
                        const factorScoreElement = document.createElement('span');
                        factorScoreElement.className = 'text-sm font-medium';
                        
                        // 根据得分设置颜色和状态
                        let status = '';
                        if (scoreLevel <= 2) {
                            factorScoreElement.className += ' text-green-600';
                            status = '正常';
                        } else if (scoreLevel <= 3) {
                            factorScoreElement.className += ' text-yellow-600';
                            status = '轻度';
                        } else {
                            factorScoreElement.className += ' text-red-600';
                            status = '明显';
                        }
                        
                        // 创建状态标签
                        const statusSpan = document.createElement('span');
                        statusSpan.className = `inline-block px-2 py-0.5 rounded text-xs font-medium mr-2`;
                        
                        if (scoreLevel <= 2) {
                            statusSpan.classList.add('bg-green-100', 'text-green-800');
                        } else if (scoreLevel <= 3) {
                            statusSpan.classList.add('bg-yellow-100', 'text-yellow-800');
                        } else {
                            statusSpan.classList.add('bg-red-100', 'text-red-800');
                        }
                        
                        statusSpan.textContent = status;
                        
                        // 设置平均分文本
                        const scoreText = document.createTextNode(`平均分: ${factorScore}`);
                        
                        // 组合状态标签和平均分文本
                        factorScoreElement.appendChild(statusSpan);
                        factorScoreElement.appendChild(scoreText);
                        
                        factorHeader.appendChild(factorNameElement);
                        factorHeader.appendChild(factorScoreElement);
                        
                        const factorInterpretationElement = document.createElement('p');
                        factorInterpretationElement.className = 'text-sm text-muted leading-relaxed';
                        
                        // 根据得分动态生成解释内容
                        let interpretation = '';
                        let advice = '';
                        
                        switch(i) {
                            case 0: // 躯体化
                                interpretation = "反映身体上的不适症状，如头痛、头晕、胸痛等。";
                                if (scoreLevel <= 2) {
                                    advice = "您在该维度得分较低，表明身体不适症状较少。建议继续保持健康的生活方式，定期进行身体检查。";
                                } else if (scoreLevel <= 3) {
                                    advice = "您在该维度得分中等，表明存在一些身体不适症状。建议关注身体健康状况，适当休息，必要时就医检查。";
                                } else {
                                    advice = "您在该维度得分较高，表明存在明显的身体不适症状。建议及时就医进行全面检查，排除器质性疾病，并考虑心理咨询以缓解身心压力。";
                                }
                                break;
                            case 1: // 强迫症状
                                interpretation = "反映反复出现的、不必要的想法或行为。";
                                if (scoreLevel <= 2) {
                                    advice = "您在该维度得分较低，表明强迫症状较少。建议继续保持良好的心理状态，学习有效的压力管理技巧。";
                                } else if (scoreLevel <= 3) {
                                    advice = "您在该维度得分中等，表明存在一些强迫症状。建议学习放松技巧，如深呼吸、冥想等，减少不必要的担忧和重复行为。";
                                } else {
                                    advice = "您在该维度得分较高，表明存在明显的强迫症状。建议寻求专业心理咨询师的帮助，学习认知行为疗法等有效的干预方法。";
                                }
                                break;
                            case 2: // 人际关系敏感
                                interpretation = "反映在人际关系中的不自在感和自卑感。";
                                if (scoreLevel <= 2) {
                                    advice = "您在该维度得分较低，表明在人际交往中感到自在。建议继续保持良好的人际互动模式，培养更多的社交技能。";
                                } else if (scoreLevel <= 3) {
                                    advice = "您在该维度得分中等，表明在人际交往中存在一些不自在感。建议参加社交技能培训，提高自信心，学习有效的沟通技巧。";
                                } else {
                                    advice = "您在该维度得分较高，表明在人际交往中存在明显的困难和自卑感。建议寻求专业心理咨询师的帮助，解决人际关系中的问题，提高社交能力。";
                                }
                                break;
                            case 3: // 抑郁
                                interpretation = "反映抑郁情绪，如对事物失去兴趣、感到孤独等。";
                                if (scoreLevel <= 2) {
                                    advice = "您在该维度得分较低，表明情绪状态良好。建议继续保持积极的生活态度，培养兴趣爱好，与亲友保持良好的沟通。";
                                } else if (scoreLevel <= 3) {
                                    advice = "您在该维度得分中等，表明存在一些抑郁情绪。建议保持积极的生活态度，增加户外活动，与亲友保持良好的沟通，必要时寻求专业帮助。";
                                } else {
                                    advice = "您在该维度得分较高，表明存在明显的抑郁情绪。建议及时寻求专业心理咨询师或精神科医生的帮助，进行更详细的评估和干预。";
                                }
                                break;
                            case 4: // 焦虑
                                interpretation = "反映焦虑情绪，如紧张、害怕、担忧等。";
                                if (scoreLevel <= 2) {
                                    advice = "您在该维度得分较低，表明情绪稳定。建议继续保持良好的心理状态，学习有效的压力管理技巧。";
                                } else if (scoreLevel <= 3) {
                                    advice = "您在该维度得分中等，表明存在一些焦虑情绪。建议学习放松技巧，如深呼吸、冥想等，减少不必要的担忧。";
                                } else {
                                    advice = "您在该维度得分较高，表明存在明显的焦虑情绪。建议寻求专业心理咨询师的帮助，学习有效的焦虑管理技巧，必要时考虑药物治疗。";
                                }
                                break;
                            case 5: // 敌对
                                interpretation = "反映敌对情绪和行为，如容易激动、想打人等。";
                                if (scoreLevel <= 2) {
                                    advice = "您在该维度得分较低，表明情绪稳定，不易激动。建议继续保持良好的情绪管理能力。";
                                } else if (scoreLevel <= 3) {
                                    advice = "您在该维度得分中等，表明存在一些敌对情绪。建议学习情绪管理技巧，如深呼吸、冥想等，减少冲动行为。";
                                } else {
                                    advice = "您在该维度得分较高，表明存在明显的敌对情绪。建议寻求专业心理咨询师的帮助，学习有效的情绪管理技巧，解决潜在的心理冲突。";
                                }
                                break;
                            case 6: // 恐怖
                                interpretation = "反映对特定事物或情境的恐惧。";
                                if (scoreLevel <= 2) {
                                    advice = "您在该维度得分较低，表明对特定事物或情境的恐惧较少。建议继续保持勇敢面对生活中的挑战。";
                                } else if (scoreLevel <= 3) {
                                    advice = "您在该维度得分中等，表明对某些事物或情境存在一定的恐惧。建议尝试逐步面对恐惧，必要时寻求专业帮助。";
                                } else {
                                    advice = "您在该维度得分较高，表明存在明显的恐惧症状。建议寻求专业心理咨询师的帮助，尝试系统脱敏法等有效的干预方法。";
                                }
                                break;
                            case 7: // 偏执
                                interpretation = "反映猜疑和偏执的思维方式。";
                                if (scoreLevel <= 2) {
                                    advice = "您在该维度得分较低，表明思维方式较为开放和信任他人。建议继续保持良好的人际信任。";
                                } else if (scoreLevel <= 3) {
                                    advice = "您在该维度得分中等，表明存在一些猜疑和偏执的思维方式。建议尝试从不同角度看待问题，增加对他人的信任。";
                                } else {
                                    advice = "您在该维度得分较高，表明存在明显的猜疑和偏执症状。建议寻求专业心理咨询师的帮助，调整思维方式，改善人际关系。";
                                }
                                break;
                            case 8: // 精神病性
                                interpretation = "反映精神病性症状，如幻觉、妄想等。";
                                if (scoreLevel <= 2) {
                                    advice = "您在该维度得分较低，表明思维清晰，没有明显的精神病性症状。建议继续保持良好的心理状态。";
                                } else if (scoreLevel <= 3) {
                                    advice = "您在该维度得分中等，表明存在一些轻微的思维异常。建议关注自己的心理状态，保持规律的作息和生活习惯。";
                                } else {
                                    advice = "您在该维度得分较高，表明存在明显的精神病性症状。建议及时寻求精神科医生的帮助，进行更详细的评估和干预。";
                                }
                                break;
                            case 9: // 其他
                                interpretation = "反映睡眠、饮食等方面的问题。";
                                if (scoreLevel <= 2) {
                                    advice = "您在该维度得分较低，表明睡眠和饮食习惯良好。建议继续保持规律的作息和健康的饮食习惯。";
                                } else if (scoreLevel <= 3) {
                                    advice = "您在该维度得分中等，表明存在一些睡眠或饮食问题。建议保持规律的作息时间，适当运动，改善睡眠和饮食习惯。";
                                } else {
                                    advice = "您在该维度得分较高，表明存在明显的睡眠或饮食问题。建议调整生活方式，必要时寻求专业帮助，如睡眠治疗或营养咨询。";
                                }
                                break;
                        }
                        
                        factorInterpretationElement.textContent = `${interpretation}${advice}`;
                        
                        interpretationItem.appendChild(factorHeader);
                        interpretationItem.appendChild(factorInterpretationElement);
                        factorsInterpretation.appendChild(interpretationItem);
                    }
                }
                
                // 如果没有得分较高的因子，显示提示信息
                if (factorsInterpretation.children.length === 0) {
                    const noIssuesElement = document.createElement('div');
                    noIssuesElement.className = 'bg-white rounded-xl p-4 border border-gray-100 shadow-sm text-center';
                    noIssuesElement.innerHTML = `
                        <div class="inline-flex items-center justify-center w-10 h-10 bg-green-100 rounded-full mb-3">
                            <i class="fa fa-check text-green-600"></i>
                        </div>
                        <p class="text-sm text-muted">您在所有维度的得分均在正常范围内，没有明显的心理症状。建议继续保持良好的生活习惯和心态。</p>
                    `;
                    factorsInterpretation.appendChild(noIssuesElement);
                }
            }
            
            // 更新专业建议
            updateProfessionalAdvice(factorScores);
            
            // 创建因子得分图表
            createFactorScoreChart(factorScores);
            

        }
        
        // 更新总分圆环进度条
        function updateScoreCircle(totalScore) {
            const scoreCircle = document.getElementById('score-circle');
            if (!scoreCircle) return;
            
            // 计算总分百分比（假设总分450为满分）
            const percentage = (totalScore / 450) * 100;
            
            // 计算圆环周长
            const circle = scoreCircle;
            const radius = circle.r.baseVal.value;
            const circumference = 2 * Math.PI * radius;
            
            // 设置圆环初始状态
            circle.style.strokeDasharray = `${circumference} ${circumference}`;
            circle.style.strokeDashoffset = circumference;
            
            // 计算偏移量
            const offset = circumference - (percentage / 100) * circumference;
            
            // 设置圆环颜色
            if (totalScore <= 160) {
                circle.style.stroke = '#10B981'; // 绿色
            } else if (totalScore <= 240) {
                circle.style.stroke = '#F59E0B'; // 黄色
            } else {
                circle.style.stroke = '#EF4444'; // 红色
            }
            
            // 应用偏移量（添加动画效果）
            setTimeout(() => {
                circle.style.strokeDashoffset = offset;
            }, 100);
        }
        
        // 更新主要问题领域
        function updateMainIssues(factorScores) {
            const mainIssuesContainer = document.getElementById('main-issues-container');
            if (!mainIssuesContainer) return;
            
            mainIssuesContainer.innerHTML = '';
            
            // 创建因子得分数组（包含因子名称和得分）
            const factorScoresWithNames = [];
            for (let i = 0; i < factorScores.length; i++) {
                factorScoresWithNames.push({
                    name: factorNames[i],
                    score: factorScores[i]
                });
            }
            
            // 按得分降序排序
            factorScoresWithNames.sort((a, b) => b.score - a.score);
            
            // 取前3个得分最高的因子
            const topFactors = factorScoresWithNames.slice(0, 3);
            
            // 为每个因子创建进度条
            topFactors.forEach((factor, index) => {
                const factorElement = document.createElement('div');
                factorElement.className = 'mb-4';
                
                const factorHeader = document.createElement('div');
                factorHeader.className = 'flex justify-between items-center mb-1';
                
                const factorName = document.createElement('span');
                factorName.className = 'text-sm font-medium';
                factorName.textContent = factor.name;
                
                const factorScore = document.createElement('span');
                factorScore.className = 'text-xs text-muted';
                factorScore.textContent = factor.score.toFixed(2);
                
                factorHeader.appendChild(factorName);
                factorHeader.appendChild(factorScore);
                
                const progressBarContainer = document.createElement('div');
                progressBarContainer.className = 'w-full bg-gray-100 rounded-full h-2';
                
                const progressBar = document.createElement('div');
                progressBar.className = 'h-2 rounded-full transition-all duration-500 ease-out';
                
                // 根据得分设置颜色
                if (factor.score <= 2) {
                    progressBar.className += ' bg-green-500';
                } else if (factor.score <= 3) {
                    progressBar.className += ' bg-yellow-500';
                } else {
                    progressBar.className += ' bg-red-500';
                }
                
                // 设置进度条宽度（假设5分为满分）
                const widthPercentage = (factor.score / 5) * 100;
                
                // 添加动画效果
                setTimeout(() => {
                    progressBar.style.width = `${widthPercentage}%`;
                }, 100 * (index + 1));
                
                progressBarContainer.appendChild(progressBar);
                
                factorElement.appendChild(factorHeader);
                factorElement.appendChild(progressBarContainer);
                
                mainIssuesContainer.appendChild(factorElement);
            });
            
            // 如果没有明显问题，显示提示信息
            if (topFactors.every(factor => factor.score <= 2)) {
                const noIssuesElement = document.createElement('div');
                noIssuesElement.className = 'bg-green-50 border border-green-200 rounded-lg p-3 text-sm text-green-800';
                noIssuesElement.innerHTML = `
                    <div class="flex items-start">
                        <i class="fa fa-check-circle mt-0.5 mr-2"></i>
                        <p>您在所有维度的得分均在正常范围内，没有明显的心理症状。建议继续保持良好的生活习惯和心态。</p>
                    </div>
                `;
                
                mainIssuesContainer.innerHTML = '';
                mainIssuesContainer.appendChild(noIssuesElement);
            }
        }

        

        // 创建因子得分图表
        function createFactorScoreChart(factorScores) {
            // 获取canvas元素
            const canvas = document.getElementById('factor-chart');
            
            // 销毁旧图表（如果存在）
            if (window.factorChart) {
                window.factorChart.destroy();
            }
            
            // 创建新图表
            window.factorChart = new Chart(canvas, {
                type: 'radar',
                data: {
                    labels: factorNames,
                    datasets: [{
                        label: '因子得分',
                        data: factorScores,
                        backgroundColor: 'rgba(79, 70, 229, 0.2)',
                        borderColor: 'rgba(79, 70, 229, 1)',
                        borderWidth: 3,
                        pointBackgroundColor: 'rgba(79, 70, 229, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(79, 70, 229, 1)',
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: {
                                display: true,
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            pointLabels: {
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                },
                                color: '#111827'
                            },
                            suggestedMin: 0,
                            suggestedMax: 5,
                            ticks: {
                                stepSize: 1,
                                backdropColor: 'transparent',
                                color: '#6B7280'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            titleColor: '#111827',
                            bodyColor: '#111827',
                            borderColor: 'rgba(79, 70, 229, 0.3)',
                            borderWidth: 1,
                            padding: 12,
                            cornerRadius: 8,
                            boxPadding: 4,
                            usePointStyle: true,
                            callbacks: {
                                label: function(context) {
                                    return `得分: ${context.raw.toFixed(2)}`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // 更新专业建议
        function updateProfessionalAdvice(factorScores) {
            professionalAdviceDiv.innerHTML = '';
            
            // 计算总均分
            const totalIndex = scores.total / questions.length;
            
            // 找出得分最高的因子
            let maxFactorIndex = 0;
            let maxFactorScore = factorScores[0];
            for (let i = 1; i < factorScores.length; i++) {
                if (factorScores[i] > maxFactorScore) {
                    maxFactorScore = factorScores[i];
                    maxFactorIndex = i;
                }
            }
            
            // 创建建议容器
            const adviceContainer = document.createElement('div');
            adviceContainer.className = 'space-y-6';
            
            // 测试结果解释卡片
            const interpretationCard = document.createElement('div');
            interpretationCard.className = 'bg-primary/5 rounded-xl p-4 border border-primary/10';
            
            const interpretationHeader = document.createElement('div');
            interpretationHeader.className = 'flex items-center mb-3';
            
            const interpretationIcon = document.createElement('div');
            interpretationIcon.className = 'w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center mr-3';
            interpretationIcon.innerHTML = '<i class="fa fa-info-circle text-primary"></i>';
            
            const interpretationTitle = document.createElement('h4');
            interpretationTitle.className = 'font-medium text-primary';
            interpretationTitle.textContent = '测试结果解释';
            
            interpretationHeader.appendChild(interpretationIcon);
            interpretationHeader.appendChild(interpretationTitle);
            
            const interpretationText = document.createElement('p');
            interpretationText.className = 'text-sm text-muted';
            interpretationText.textContent = 'SCL-90量表是一种常用的心理健康自评工具，用于评估个体在一段时间内的心理症状状况。该量表包含90个项目，涵盖了广泛的心理症状，包括躯体化、强迫症状、人际关系敏感、抑郁、焦虑、敌对、恐怖、偏执、精神病性等9个维度。';
            
            interpretationCard.appendChild(interpretationHeader);
            interpretationCard.appendChild(interpretationText);
            adviceContainer.appendChild(interpretationCard);
            
            // 总分解释卡片
            const totalScoreCard = document.createElement('div');
            totalScoreCard.className = 'bg-white rounded-xl p-4 border border-gray-100 shadow-sm';
            
            const totalScoreHeader = document.createElement('div');
            totalScoreHeader.className = 'flex items-center mb-3';
            
            const totalScoreIcon = document.createElement('div');
            totalScoreIcon.className = 'w-8 h-8 bg-blue-50 rounded-full flex items-center justify-center mr-3';
            totalScoreIcon.innerHTML = '<i class="fa fa-bar-chart text-blue-500"></i>';
            
            const totalScoreTitle = document.createElement('h4');
            totalScoreTitle.className = 'font-medium text-blue-700';
            totalScoreTitle.textContent = '总分解释';
            
            totalScoreHeader.appendChild(totalScoreIcon);
            totalScoreHeader.appendChild(totalScoreTitle);
            
            const totalScoreText = document.createElement('p');
            totalScoreText.className = 'text-sm text-muted';
            
            let totalScoreInterpretation = '';
            if (scores.total <= 160) {
                totalScoreInterpretation = '您的总分较低，表明心理健康状况良好。';
            } else if (scores.total <= 240) {
                totalScoreInterpretation = '您的总分中等，表明可能存在轻度心理问题。';
            } else {
                totalScoreInterpretation = '您的总分较高，表明可能存在较明显的心理问题。';
            }
            
            totalScoreText.textContent = `您的总分为${scores.total}分，总均分为${totalIndex.toFixed(2)}分。${totalScoreInterpretation}总分越高，表明心理健康状况越差。一般来说，总分超过160分，或阳性项目数超过43项，或任一因子分超过2分，建议进一步检查。`;
            
            totalScoreCard.appendChild(totalScoreHeader);
            totalScoreCard.appendChild(totalScoreText);
            adviceContainer.appendChild(totalScoreCard);
            
            // 主要问题领域卡片
            const mainIssueCard = document.createElement('div');
            mainIssueCard.className = 'bg-white rounded-xl p-4 border border-gray-100 shadow-sm';
            
            const mainIssueHeader = document.createElement('div');
            mainIssueHeader.className = 'flex items-center mb-3';
            
            const mainIssueIcon = document.createElement('div');
            mainIssueIcon.className = 'w-8 h-8 bg-yellow-50 rounded-full flex items-center justify-center mr-3';
            mainIssueIcon.innerHTML = '<i class="fa fa-exclamation-triangle text-yellow-500"></i>';
            
            const mainIssueTitle = document.createElement('h4');
            mainIssueTitle.className = 'font-medium text-yellow-700';
            mainIssueTitle.textContent = '主要问题领域';
            
            mainIssueHeader.appendChild(mainIssueIcon);
            mainIssueHeader.appendChild(mainIssueTitle);
            
            const mainIssueText = document.createElement('p');
            mainIssueText.className = 'text-sm text-muted';
            
            let mainIssueInterpretation = '';
            if (maxFactorScore <= 2) {
                mainIssueInterpretation = '您在各个维度的得分都较低，没有明显的心理症状。';
            } else if (maxFactorScore <= 3) {
                mainIssueInterpretation = `您在${factorNames[maxFactorIndex]}维度得分较高，表明存在中等程度的${factorNames[maxFactorIndex]}症状。`;
            } else {
                mainIssueInterpretation = `您在${factorNames[maxFactorIndex]}维度得分较高，表明存在明显的${factorNames[maxFactorIndex]}症状。`;
            }
            
            mainIssueText.textContent = mainIssueInterpretation;
            
            mainIssueCard.appendChild(mainIssueHeader);
            mainIssueCard.appendChild(mainIssueText);
            adviceContainer.appendChild(mainIssueCard);
            
            // 针对性建议卡片
            const adviceCard = document.createElement('div');
            adviceCard.className = 'bg-white rounded-xl p-4 border border-gray-100 shadow-sm';
            
            const adviceHeader = document.createElement('div');
            adviceHeader.className = 'flex items-center mb-3';
            
            const adviceIcon = document.createElement('div');
            adviceIcon.className = 'w-8 h-8 bg-green-50 rounded-full flex items-center justify-center mr-3';
            adviceIcon.innerHTML = '<i class="fa fa-lightbulb-o text-green-500"></i>';
            
            const adviceTitle = document.createElement('h4');
            adviceTitle.className = 'font-medium text-green-700';
            adviceTitle.textContent = '建议与指导';
            
            adviceHeader.appendChild(adviceIcon);
            adviceHeader.appendChild(adviceTitle);
            
            const adviceList = document.createElement('ul');
            adviceList.className = 'list-disc list-inside space-y-3 text-sm text-muted';
            
            // 根据主要问题领域提供针对性建议
            let targetedAdvice = '';
            switch(maxFactorIndex) {
                case 0: // 躯体化
                    targetedAdvice = '关注身体健康状况，定期进行身体检查；学习放松技巧，如深呼吸、渐进性肌肉松弛等；保持规律的作息和适度的运动。';
                    break;
                case 1: // 强迫症状
                    targetedAdvice = '学习认知行为疗法中的暴露与反应预防技术；练习正念冥想，提高对不必要想法的觉察能力；减少对完美主义的追求。';
                    break;
                case 2: // 人际关系敏感
                    targetedAdvice = '参加社交技能培训，提高人际交往能力；学习有效的沟通技巧，如积极倾听、表达自己的需求等；寻求支持性的人际关系。';
                    break;
                case 3: // 抑郁
                    targetedAdvice = '保持积极的生活态度，培养兴趣爱好；增加户外活动，接受阳光照射；与亲友保持良好的沟通，寻求情感支持。';
                    break;
                case 4: // 焦虑
                    targetedAdvice = '学习放松技巧，如深呼吸、冥想、渐进性肌肉松弛等；练习时间管理，合理安排任务；减少咖啡因和酒精的摄入。';
                    break;
                case 5: // 敌对
                    targetedAdvice = '学习情绪管理技巧，如情绪识别、表达和调节；练习换位思考，理解他人的观点；寻找健康的方式释放压力。';
                    break;
                case 6: // 恐怖
                    targetedAdvice = '尝试系统脱敏法，逐步面对恐惧的事物或情境；学习放松技巧，减轻焦虑反应；寻求专业心理咨询师的帮助。';
                    break;
                case 7: // 偏执
                    targetedAdvice = '尝试从不同角度看待问题，增加对他人的信任；学习沟通技巧，直接表达自己的想法和感受；减少猜疑，基于事实做出判断。';
                    break;
                case 8: // 精神病性
                    targetedAdvice = '及时寻求精神科医生的帮助，进行专业评估；保持规律的作息和生活习惯；避免使用酒精和其他精神活性物质。';
                    break;
                case 9: // 其他
                    targetedAdvice = '保持规律的作息时间，建立健康的睡眠习惯；注意饮食均衡，避免过量摄入咖啡因和糖分；适当运动，改善睡眠质量。';
                    break;
            }
            
            // 针对性建议
            const targetedAdviceItem = document.createElement('li');
            targetedAdviceItem.innerHTML = `<span class="font-medium text-green-700">针对性建议：</span>${targetedAdvice}`;
            adviceList.appendChild(targetedAdviceItem);
            
            // 通用建议
            const generalAdviceItem = document.createElement('li');
            generalAdviceItem.innerHTML = `<span class="font-medium text-green-700">通用建议：</span>保持健康的生活方式，包括规律作息、均衡饮食和适度运动；学习并实践压力管理技巧，如正念冥想、深呼吸练习等；与亲友保持良好的沟通，建立支持系统。`;
            adviceList.appendChild(generalAdviceItem);
            
            // 专业帮助建议
            const professionalHelpItem = document.createElement('li');
            professionalHelpItem.innerHTML = `<span class="font-medium text-green-700">专业帮助：</span>如果您感到困扰或症状持续存在，建议寻求专业心理咨询师或精神科医生的帮助。他们可以提供更详细的评估和专业的治疗建议。`;
            adviceList.appendChild(professionalHelpItem);
            
            adviceCard.appendChild(adviceHeader);
            adviceCard.appendChild(adviceList);
            adviceContainer.appendChild(adviceCard);
            
            // 注意事项卡片
            const noteCard = document.createElement('div');
            noteCard.className = 'bg-amber-50 rounded-xl p-4 border border-amber-100';
            
            const noteHeader = document.createElement('div');
            noteHeader.className = 'flex items-center mb-3';
            
            const noteIcon = document.createElement('div');
            noteIcon.className = 'w-8 h-8 bg-amber-100 rounded-full flex items-center justify-center mr-3';
            noteIcon.innerHTML = '<i class="fa fa-warning text-amber-600"></i>';
            
            const noteTitle = document.createElement('h4');
            noteTitle.className = 'font-medium text-amber-700';
            noteTitle.textContent = '重要提示';
            
            noteHeader.appendChild(noteIcon);
            noteHeader.appendChild(noteTitle);
            
            const noteList = document.createElement('ul');
            noteList.className = 'list-disc list-inside space-y-2 text-sm text-amber-800';
            
            const note1 = document.createElement('li');
            note1.textContent = '本测试仅供参考，不能替代专业的心理咨询或诊断。';
            noteList.appendChild(note1);
            
            const note2 = document.createElement('li');
            note2.textContent = '测试结果仅反映当前的心理状态，随着时间和环境的变化可能会有所不同。';
            noteList.appendChild(note2);
            
            const note3 = document.createElement('li');
            note3.textContent = '如果您的测试结果显示存在较严重的心理问题，或症状持续超过两周，建议及时寻求专业心理咨询师或医生的帮助。';
            noteList.appendChild(note3);
            
            noteCard.appendChild(noteHeader);
            noteCard.appendChild(noteList);
            adviceContainer.appendChild(noteCard);
            
            professionalAdviceDiv.appendChild(adviceContainer);
        }

        

        // 初始化应用
        document.addEventListener('DOMContentLoaded', init);
    </script>
<!-- 授权码弹窗 -->
<div id="verify-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-xl p-6 w-80 text-center shadow-lg relative">
    <!-- 右上角关闭按钮 -->
    <button onclick="closeVerifyModal()" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600">
      <i class="fa fa-times text-lg"></i>
    </button>

    <h3 class="text-lg font-semibold mb-4">请输入6位授权码</h3>
    <input id="verify-code-input" type="text" maxlength="6" placeholder="授权码" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-4 text-center uppercase">

    <div id="verify-message" class="text-sm mb-4 text-red-500 hidden"></div>

    <!-- 按钮区域 -->
    <div class="flex justify-between space-x-3">
      <button onclick="verifyCode()" class="flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
        验证授权码
      </button>
      <a href="https://xhslink.com/m/2zcEcoXiLnR" target="_blank" class="flex-1 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition text-center">
        获取授权码
      </a>
    </div>
  </div>
</div>

<script>
function verifyCode() {
  const code = $('#verify-code-input').val().trim().toUpperCase();
  if (!code || code.length !== 6) {
    $('#verify-message').text('请输入完整的6位授权码').removeClass('hidden');
    return;
  }

  $.ajax({
    url: 'https://soultest.top/api/verify',
    method: 'POST',
    contentType: 'application/json',
    data: JSON.stringify({ code: code }),
    success: function (res) {
      if (res.valid) {
        // ✅ 显示成功提示
        Swal.fire({
          icon: 'success',
          title: '验证成功',
          text: '正在进入测试页面...',
          timer: 1500,
          showConfirmButton: false,
          willClose: () => {
            // ✅ 保存48小时通行证
            localStorage.setItem('scl90_authorized', code);
            localStorage.setItem('scl90_expire', Date.now() + 48 * 60 * 60 * 1000);
            $('#verify-modal').addClass('hidden');
            startTest();
          }
        });
      } else {
        $('#verify-message').text(res.message).removeClass('hidden');
      }
    },
    error: function () {
      $('#verify-message').text('网络错误，请重试').removeClass('hidden');
    }
  });
}



function closeVerifyModal() {
  $('#verify-modal').addClass('hidden');
  $('#verify-message').addClass('hidden');
  $('#verify-code-input').val('');
}
</script>
</script>
</body>
</html>
